openapi: 3.0.3
info:
  description: RESTful APIs for SUSTech Merch Store.
  title: SUSTech Merch Store
  version: 1.0.0
servers:
- url: /
tags:
- description: Simpel welcome API
  name: Greeting
- description: Operations for getting information of products
  name: Product
- description: User account management
  name: User
- description: Operations for orders
  name: Order
paths:
  /:
    get:
      description: Get a hello-world greeting.
      operationId: greet
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
          description: A successful welcome message
      tags:
      - Greeting
      x-openapi-router-controller: src.api_service.controllers.greeting_controller
  /orders:
    get:
      operationId: list_orders
      parameters:
      - description: Maximum number of orders to return
        explode: true
        in: query
        name: limit
        required: false
        schema:
          default: 20
          type: integer
        style: form
      - description: Number of orders to skip for pagination
        explode: true
        in: query
        name: offset
        required: false
        schema:
          default: 0
          type: integer
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/OrderInfo"
                type: array
          description: A list of orders for the authenticated user.
        "401":
          description: "Unauthorized, authentication token is missing or invalid."
      security:
      - bearerAuth: []
      summary: Get all orders for the user
      tags:
      - Order
      x-openapi-router-controller: src.api_service.controllers.order_controller
    post:
      operationId: place_order
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OrderItem"
        description: A list of products and their quantities to order.
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderInfo"
          description: Order created successfully. Returns the new order details.
        "400":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: "Bad request, e.g., product out of stock or invalid product\
            \ ID."
        "401":
          description: "Unauthorized, authentication token is missing or invalid."
      security:
      - bearerAuth: []
      summary: Place a new order
      tags:
      - Order
      x-openapi-router-controller: src.api_service.controllers.order_controller
  /orders/{orderId}:
    get:
      operationId: get_order_by_id
      parameters:
      - description: The ID of the order to retrieve.
        explode: false
        in: path
        name: orderId
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderInfo"
          description: "Successful operation, returns order details."
        "401":
          description: Unauthorized.
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Order not found or does not belong to the user.
      security:
      - bearerAuth: []
      summary: Get details of a specific order
      tags:
      - Order
      x-openapi-router-controller: src.api_service.controllers.order_controller
  /orders/{orderId}/cancel:
    post:
      operationId: cancel_order
      parameters:
      - description: The ID of the order to cancel.
        explode: false
        in: path
        name: orderId
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/OrderInfo"
          description: Order cancelled successfully. Returns the updated order.
        "401":
          description: Unauthorized.
        "404":
          description: Order not found or does not belong to the user.
      security:
      - bearerAuth: []
      summary: Cancel an existing order
      tags:
      - Order
      x-openapi-router-controller: src.api_service.controllers.order_controller
  /products:
    get:
      description: Get all products on sale
      operationId: list_products
      responses:
        "200":
          content:
            application/json:
              schema:
                items:
                  $ref: "#/components/schemas/ProductBreifInfo"
                type: array
          description: An array of products
      tags:
      - Product
      x-openapi-router-controller: src.api_service.controllers.product_controller
  /products/{productId}:
    get:
      description: Find product by ID
      operationId: get_product_by_id
      parameters:
      - description: The ID of the product to get
        explode: false
        in: path
        name: productId
        required: true
        schema:
          type: integer
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductInfo"
          description: "Successful operation, returns a single product."
        "404":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Product not found
      tags:
      - Product
      x-openapi-router-controller: src.api_service.controllers.product_controller
  /users/login:
    post:
      operationId: login_user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserLogin"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/login_user_200_response"
          description: "Successful login, returns an authentication token."
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Invalid username or password.
      summary: Logs user into the system
      tags:
      - User
      x-openapi-router-controller: src.api_service.controllers.user_controller
  /users/me:
    get:
      operationId: get_current_user
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
          description: "Successful operation, returns the current user's profile."
        "401":
          description: "Unauthorized, authentication token is missing or invalid."
      security:
      - bearerAuth: []
      summary: Get current user's profile
      tags:
      - User
      x-openapi-router-controller: src.api_service.controllers.user_controller
    put:
      operationId: update_current_user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserUpdate"
        description: Fields to update for the user. Only non-null fields will be updated.
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
          description: User updated successfully. Returns the updated user profile.
        "401":
          description: "Unauthorized, authentication token is missing or invalid."
        "409":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: "Conflict, e.g., the new email address is already in use."
      security:
      - bearerAuth: []
      summary: Update current user's profile
      tags:
      - User
      x-openapi-router-controller: src.api_service.controllers.user_controller
  /users/me/delete:
    post:
      operationId: deactivate_user
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Message"
          description: User deleted successfully.
        "401":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: "Unauthorized, authentication token is missing or invalid."
        "500":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: Internal server error.
      security:
      - bearerAuth: []
      summary: Delete the current user
      tags:
      - User
      x-openapi-router-controller: src.api_service.controllers.user_controller
  /users/register:
    post:
      operationId: register_user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegistration"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
          description: User created successfully. Returns the new user's public profile.
        "409":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: "Conflict, the username or email is already in use."
      summary: Register a new user
      tags:
      - User
      x-openapi-router-controller: src.api_service.controllers.user_controller
components:
  schemas:
    Message:
      example:
        message: Welcome to the SUSTech Merch Store!
      properties:
        message:
          example: Welcome to the SUSTech Merch Store!
          title: message
          type: string
      title: Message
      type: object
    Error:
      example:
        message: Resource not found
      properties:
        message:
          example: Resource not found
          title: message
          type: string
      title: Error
      type: object
    ProductBreifInfo:
      example:
        price: 49.99
        name: SUSTech Hoodie
        id: 1
        stock: 500
      properties:
        id:
          example: 1
          title: id
          type: integer
        name:
          example: SUSTech Hoodie
          title: name
          type: string
        price:
          example: 49.99
          format: float
          title: price
          type: number
        stock:
          example: 500
          title: stock
          type: integer
      title: ProductBreifInfo
      type: object
    ProductInfo:
      example:
        price: 49.99
        name: SUSTech Hoodie
        description: "ðŸ§¥ A cozy, stylish hoodie featuring the official SUSTech logo,\
          \ perfect for showing school spirit."
        created_at: 2025-11-08T15:30:00Z
        id: 1
        category: Apparel
        stock: 500
      properties:
        id:
          example: 1
          title: id
          type: integer
        name:
          example: SUSTech Hoodie
          title: name
          type: string
        description:
          example: "ðŸ§¥ A cozy, stylish hoodie featuring the official SUSTech logo,\
            \ perfect for showing school spirit."
          title: description
          type: string
        category:
          example: Apparel
          title: category
          type: string
        price:
          example: 49.99
          format: float
          title: price
          type: number
        stock:
          example: 500
          title: stock
          type: integer
        created_at:
          example: 2025-11-08T15:30:00Z
          format: date-time
          title: created_at
          type: string
      title: ProductInfo
      type: object
    UserRegistration:
      example:
        password: password
        email: 12211418@mail.sustech.edu.cn
        sid: "12211418"
        username: loring
      properties:
        sid:
          example: "12211418"
          title: sid
          type: string
        username:
          example: loring
          title: username
          type: string
        email:
          example: 12211418@mail.sustech.edu.cn
          format: email
          title: email
          type: string
        password:
          format: password
          title: password
          type: string
      required:
      - email
      - password
      - sid
      - username
      title: UserRegistration
      type: object
    UserLogin:
      example:
        password: password
        sid: sid
      properties:
        sid:
          title: sid
          type: string
        password:
          format: password
          title: password
          type: string
      required:
      - password
      - sid
      title: UserLogin
      type: object
    AuthToken:
      properties:
        access_token:
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
          type: string
        token_type:
          example: bearer
          type: string
      type: object
    UserInfo:
      example:
        created_at: 2025-11-08T10:00:00Z
        id: 101
        email: 12211418@mail.sustech.edu.cn
        sid: "12211418"
        username: loring
      properties:
        id:
          example: 101
          title: id
          type: integer
        sid:
          example: "12211418"
          title: sid
          type: string
        username:
          example: loring
          title: username
          type: string
        email:
          example: 12211418@mail.sustech.edu.cn
          format: email
          title: email
          type: string
        created_at:
          example: 2025-11-08T10:00:00Z
          format: date-time
          title: created_at
          type: string
      title: UserInfo
      type: object
    UserUpdate:
      example:
        password: a-very-strong-new-password
        email: new.email@example.com
      properties:
        email:
          description: New email address. Must be unique.
          example: new.email@example.com
          format: email
          title: email
          type: string
        password:
          description: New password. Should meet complexity requirements.
          example: a-very-strong-new-password
          format: password
          title: password
          type: string
      title: UserUpdate
      type: object
    OrderItem:
      example:
        quantity: 2
        product_id: 1
      properties:
        product_id:
          example: 1
          title: product_id
          type: integer
        quantity:
          example: 2
          minimum: 1
          title: quantity
          type: integer
      required:
      - product_id
      - quantity
      title: OrderItem
      type: object
    OrderInfo:
      example:
        quantity: 2
        total_price: 49.99
        user_id: "12211418"
        product_id: 1
        created_at: 2025-11-09T10:20:30Z
        id: 1
      properties:
        id:
          example: 1
          title: id
          type: integer
        user_id:
          example: "12211418"
          title: user_id
          type: string
        product_id:
          example: 1
          title: product_id
          type: integer
        quantity:
          example: 2
          title: quantity
          type: integer
        total_price:
          example: 49.99
          title: total_price
          type: number
        created_at:
          example: 2025-11-09T10:20:30Z
          format: date-time
          title: created_at
          type: string
      title: OrderInfo
      type: object
    login_user_200_response:
      example:
        user:
          created_at: 2025-11-08T10:00:00Z
          id: 101
          email: 12211418@mail.sustech.edu.cn
          sid: "12211418"
          username: loring
        token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
      properties:
        token:
          description: JWT token for authentication
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
          title: token
          type: string
        user:
          $ref: "#/components/schemas/UserInfo"
      title: login_user_200_response
      type: object
  securitySchemes:
    bearerAuth:
      bearerFormat: JWT
      description: "Enter JWT Bearer token in the format: Bearer {token}"
      scheme: bearer
      type: http
      x-bearerInfoFunc: openapi_server.controllers.security_controller.info_from_bearerAuth
